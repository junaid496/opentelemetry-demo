name: Complete CI/CD Pipeline

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  # Original OpenTelemetry Jobs
  build_images:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Build Docker Images
        run: echo "Docker build would run here"

  yamllint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Validate YAML
        run: |
          pip install yamllint
          yamllint .

  markdownlint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Lint Markdown
        run: |
          npm install -g markdownlint-cli
          markdownlint "**/*.md"

  misspell:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Check Spelling
        run: |
          curl -L -o install-misspell.sh https://git.io/misspell
          sh install-misspell.sh
          misspell -error .

  linkspector:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Check Links
        run: echo "Link validation would run here"

  sanity:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Sanity Tests
        run: echo "Sanity tests would run here"

  checklicense:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: License Check
        run: echo "License check would run here"

  # Tumhara ArgoCD Integration (Final Step)
  notify-argocd:
    needs: [build_images, yamllint, markdownlint, misspell, linkspector, sanity, checklicense]
    runs-on: ubuntu-latest
    if: always() && (
      needs.build_images.result == 'success' &&
      needs.yamllint.result == 'success' &&
      needs.markdownlint.result == 'success' &&
      needs.misspell.result == 'success' &&
      needs.linkspector.result == 'success' &&
      needs.sanity.result == 'success' &&
      needs.checklicense.result == 'success'
    )
    steps:
      - name: Trigger ArgoCD Sync
        run: |
          curl -k -X POST https://a5cde3e6cf64645d4b9f39093b86736c-1645307027.us-east-1.elb.amazonaws.com/api/v1/applications/otel-demo/sync \
            -H "Authorization: Bearer ${{ secrets.ARGOCD_TOKEN }}" \
            -H "Content-Type: application/json"



