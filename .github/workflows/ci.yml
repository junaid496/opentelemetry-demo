name: ArgoCD Sync Test

on:
  push:
    branches: [main]

jobs:
  trigger-argocd:
    name: Trigger ArgoCD Sync
    runs-on: ubuntu-latest
    steps:
    - name: Sync ArgoCD
      run: |
        echo "üöÄ Testing ArgoCD Sync..."
        
        # Simple API call
        curl -k -X POST \
          "https://a5cde3e6cf64645d4b9f39093b86736c-1645307027.us-east-1.elb.amazonaws.com/api/v1/applications/otel-demo/sync" \
          -H "Authorization: Bearer ${{ secrets.ARGOCD_TOKEN }}" \
          -H "Content-Type: application/json"
        
        echo "‚úÖ Sync request sent to ArgoCD!"
        echo "üìù Check ArgoCD UI for sync status"
